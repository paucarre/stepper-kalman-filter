//
//  KalmaGainTest.cpp
//  KalmanFilter
//
//  Created by Pau Cardona on 14/05/2017.
//  Copyright Â© 2017 Pau Carre. All rights reserved.
//

#include <KalmanGain.hpp>
#include <KalmanFilter.hpp>
int main() {
    float sensorVariance = 0.001111076514;
    float timeInterval = 0.050; // 50 ms
    KalmanGain kalmanGain = KalmanGain::compute(sensorVariance, timeInterval, 1e-10, sensorVariance, sensorVariance * sensorVariance, 0.0, sensorVariance * sensorVariance);
    printf("Final Position Kalman Gain: %f\n", kalmanGain.getPositionKalmanGain());
    //
    float measures16[958] = {16.57,16.55,16.59,16.59,16.57,16.5,16.59,16.57,16.55,16.57,16.59,16.57,16.57,16.55,16.57,16.61,16.61,16.59,16.59,16.59,16.52,16.5,16.57,16.61,16.57,16.52,16.55,16.57,16.55,16.57,16.52,16.5,16.57,16.57,16.59,16.59,16.59,16.66,16.55,16.57,16.52,16.61,16.52,16.57,16.55,16.61,16.57,16.59,16.59,16.57,16.57,16.55,16.57,16.59,16.57,16.61,16.57,16.61,16.59,16.57,16.61,16.59,16.59,16.57,16.55,16.59,16.59,16.63,16.52,16.57,16.57,16.55,16.59,16.57,16.59,16.55,16.63,16.55,16.55,16.5,16.55,16.59,16.59,16.5,16.52,16.61,16.57,16.59,16.57,16.59,16.59,16.55,16.55,16.57,16.57,16.52,16.55,16.66,16.61,16.52,16.5,16.61,16.57,16.57,16.59,16.55,16.61,16.57,16.55,16.5,16.59,16.55,16.5,16.59,16.57,16.61,16.57,16.48,16.52,16.52,16.57,16.57,16.55,16.52,16.59,16.57,16.5,16.52,16.55,16.52,16.59,16.61,16.57,16.55,16.59,16.52,16.57,16.57,16.52,16.55,16.57,16.55,16.57,16.68,16.57,16.55,16.55,16.57,16.57,16.57,16.61,16.52,16.52,16.57,16.52,16.59,16.57,16.55,16.63,16.5,16.57,16.57,16.57,16.63,16.59,16.57,16.57,16.52,16.57,16.55,16.57,16.55,16.57,16.52,16.52,16.57,16.5,16.59,16.61,16.61,16.55,16.59,16.52,16.55,16.57,16.55,16.52,16.63,16.57,16.55,16.57,16.55,16.57,16.59,16.61,16.55,16.52,16.61,16.61,16.5,16.55,16.55,16.61,16.55,16.52,16.55,16.61,16.5,16.55,16.55,16.59,16.52,16.5,16.5,16.59,16.55,16.55,16.52,16.55,16.57,16.5,16.52,16.57,16.57,16.55,16.57,16.52,16.61,16.57,16.57,16.55,16.57,16.55,16.59,16.55,16.52,16.57,16.55,16.57,16.59,16.55,16.52,16.52,16.63,16.55,16.57,16.61,16.59,16.59,16.57,16.52,16.59,16.57,16.55,16.52,16.59,16.52,16.59,16.57,16.55,16.59,16.57,16.5,16.55,16.55,16.59,16.55,16.61,16.55,16.55,16.59,16.59,16.59,16.55,16.55,16.61,16.57,16.59,16.57,16.57,16.57,16.55,16.55,16.5,16.59,16.55,16.59,16.55,16.59,16.57,16.57,16.59,16.55,16.57,16.61,16.57,16.61,16.57,16.57,16.61,16.5,16.57,16.57,16.52,16.66,16.52,16.57,16.61,16.57,16.5,16.57,16.63,16.57,16.61,16.55,16.52,16.52,16.57,16.55,16.59,16.55,16.59,16.5,16.55,16.59,16.61,16.61,16.57,16.57,16.55,16.57,16.57,16.55,16.57,16.55,16.55,16.57,16.52,16.55,16.55,16.55,16.52,16.59,16.57,16.59,16.55,16.59,16.63,16.57,16.55,16.57,16.57,16.57,16.59,16.59,16.59,16.52,16.57,16.55,16.66,16.59,16.57,16.55,16.63,16.55,16.57,16.57,16.55,16.55,16.55,16.55,16.59,16.57,16.55,16.57,16.57,16.61,16.55,16.57,16.52,16.59,16.63,16.57,16.63,16.52,16.59,16.57,16.59,16.57,16.57,16.59,16.55,16.55,16.55,16.59,16.59,16.59,16.61,16.57,16.59,16.55,16.52,16.57,16.5,16.61,16.61,16.61,16.57,16.57,16.59,16.61,16.55,16.55,16.61,16.57,16.66,16.57,16.52,16.59,16.59,16.55,16.55,16.55,16.52,16.59,16.57,16.63,16.57,16.55,16.59,16.63,16.5,16.57,16.59,16.57,16.57,16.52,16.5,16.5,16.55,16.55,16.59,16.59,16.61,16.52,16.57,16.57,16.5,16.55,16.59,16.59,16.57,16.57,16.55,16.59,16.61,16.57,16.59,16.55,16.59,16.52,16.55,16.61,16.55,16.55,16.52,16.59,16.55,16.52,16.57,16.59,16.59,16.57,16.5,16.59,16.55,16.57,16.59,16.61,16.55,16.52,16.63,16.63,16.5,16.55,16.55,16.59,16.61,16.57,16.57,16.52,16.59,16.59,16.63,16.52,16.57,16.55,16.57,16.55,16.52,16.59,16.5,16.55,16.59,16.52,16.61,16.52,16.55,16.57,16.57,16.59,16.57,16.59,16.59,16.52,16.61,16.63,16.55,16.55,16.61,16.59,16.52,16.55,16.59,16.59,16.61,16.57,16.55,16.55,16.48,16.57,16.5,16.59,16.44,16.57,16.66,16.59,16.59,16.57,16.63,16.57,16.59,16.57,16.52,16.63,16.55,16.63,16.59,16.57,16.59,16.61,16.55,16.63,16.59,16.55,16.57,16.57,16.55,16.57,16.5,16.57,16.55,16.48,16.55,16.55,16.59,16.57,16.59,16.55,16.5,16.5,16.52,16.55,16.61,16.59,16.55,16.5,16.55,16.59,16.57,16.57,16.55,16.59,16.5,16.55,16.52,16.57,16.55,16.55,16.57,16.52,16.61,16.52,16.55,16.57,16.55,16.59,16.59,16.52,16.57,16.61,16.55,16.52,16.57,16.57,16.55,16.55,16.55,16.52,16.57,16.57,16.55,16.57,16.61,16.59,16.52,16.57,16.57,16.57,16.5,16.55,16.55,16.59,16.57,16.61,16.57,16.59,16.63,16.55,16.55,16.59,16.52,16.57,16.5,16.57,16.52,16.59,16.57,16.52,16.61,16.52,16.59,16.52,16.57,16.59,16.59,16.55,16.57,16.55,16.55,16.52,16.59,16.61,16.55,16.61,16.57,16.61,16.57,16.55,16.52,16.48,16.55,16.59,16.61,16.57,16.55,16.61,16.55,16.5,16.5,16.52,16.57,16.61,16.52,16.59,16.55,16.59,16.55,16.59,16.5,16.59,16.57,16.55,16.61,16.55,16.57,16.57,16.59,16.55,16.59,16.57,16.61,16.52,16.55,16.59,16.57,16.48,16.52,16.59,16.59,16.57,16.57,16.55,16.59,16.57,16.57,16.61,16.57,16.59,16.59,16.59,16.57,16.52,16.61,16.57,16.63,16.59,16.55,16.57,16.57,16.57,16.57,16.55,16.59,16.55,16.63,16.61,16.52,16.57,16.59,16.57,16.52,16.55,16.59,16.5,16.59,16.52,16.66,16.55,16.59,16.59,16.55,16.5,16.55,16.57,16.61,16.57,16.61,16.61,16.59,16.59,16.55,16.57,16.59,16.5,16.57,16.5,16.55,16.59,16.55,16.59,16.52,16.66,16.59,16.52,16.55,16.57,16.55,16.59,16.59,16.55,16.57,16.59,16.61,16.57,16.59,16.61,16.59,16.61,16.57,16.61,16.57,16.5,16.52,16.52,16.57,16.52,16.55,16.52,16.52,16.52,16.55,16.55,16.61,16.61,16.61,16.57,16.5,16.57,16.57,16.57,16.55,16.57,16.55,16.59,16.59,16.57,16.57,16.59,16.55,16.5,16.59,16.55,16.55,16.55,16.55,16.52,16.61,16.57,16.57,16.55,16.59,16.57,16.57,16.5,16.59,16.66,16.55,16.59,16.59,16.55,16.55,16.61,16.52,16.59,16.52,16.57,16.63,16.57,16.55,16.52,16.55,16.61,16.57,16.57,16.61,16.57,16.59,16.57,16.57,16.59,16.55,16.59,16.55,16.55,16.52,16.52,16.59,16.52,16.55,16.57,16.61,16.57,16.57,16.5,16.57,16.59,16.59,16.59,16.57,16.5,16.59,16.55,16.61,16.57,16.59,16.61,16.59,16.59,16.63,16.61,16.57,16.57,16.57,16.57,16.57,16.57,16.55,16.61,16.55,16.59,16.52,16.66,16.55,16.55,16.57,16.55,16.63,16.59,16.55,16.61,16.61,16.57,16.57,16.57,16.57,16.59,16.57,16.55,16.55,16.63,16.59,16.55,16.59,16.59,16.57,16.57,16.57,16.57,16.57,16.57,16.59,16.55,16.59,16.61,16.55,16.59,16.57,16.57,16.63,16.5,16.59,16.5,16.61,16.59,16.61,16.5,16.61,16.61,16.59,16.5,16.57,16.55,16.52,16.61,16.59,16.55,16.55,16.55,16.57,16.57,16.55,16.59,16.63,16.59,16.52,16.57,16.52};
    KalmanFilter kalmanFilter16(measures16[0], 0.0, kalmanGain.getPositionKalmanGain());
    for(int step = 1;step < 958;step++){
        kalmanFilter16.step(measures16[step], timeInterval);
        //printf("Position with expected mean 16.566: %f\n", kalmanFilter.getPositionEstimate());
        //printf("Velocity with expected mean 0.0: %f\n", kalmanFilter.getVelocityEstimate());
        printf("%f\n", kalmanFilter16.getPositionEstimate());
    }
    
    float measuresCteSpeed[981] = {50.54,50.27,49.88,49.61,49.22,48.93,48.52,48.23,47.83,47.5,47.13,46.85,46.49,46.16,45.75,45.48,45.11,44.82,44.41,44.12,43.77,43.44,43.09,42.78,42.36,42.1,41.7,41.35,41.09,40.72,40.36,40.1,39.64,39.31,38.91,38.58,38.36,37.95,37.6,37.27,36.91,36.61,36.21,35.86,35.57,35.27,34.89,34.5,34.12,33.79,33.49,33.16,32.78,32.41,32.01,31.73,31.4,31.03,30.76,30.48,30.1,29.69,29.29,29.07,28.67,28.34,28.02,27.62,27.31,27,26.65,26.37,25.95,25.62,25.33,24.98,24.54,24.26,23.86,23.51,23.2,22.92,22.46,22.15,21.8,21.51,21.09,20.72,20.46,20.1,19.78,19.47,19.14,18.74,18.39,18.11,17.67,17.36,16.92,16.7,16.28,15.95,15.64,15.25,14.96,14.66,14.3,13.93,13.56,13.18,12.9,12.5,12.17,11.84,11.54,11.16,10.79,10.44,10.11,9.71,9.45,9.03,8.7,8.33,8,7.71,7.32,7.01,6.66,6.26,5.98,5.56,5.21,4.86,4.53,4.24,3.91,3.58,3.21,2.9,2.5,2.15,1.78,1.47,1.14,0.81,0.44,0.11,359.71,359.41,358.99,358.7,358.37,357.98,357.6,357.3,356.97,356.59,356.29,355.89,355.58,355.25,354.86,354.53,354.18,353.8,353.39,353.1,352.79,352.46,352.09,351.76,351.41,351.1,350.68,350.4,350.05,349.65,349.37,349.04,348.68,348.31,348,347.63,347.28,346.88,346.53,346.2,345.92,345.54,345.15,344.82,344.51,344.2,343.87,343.41,343.13,342.82,342.4,342.05,341.72,341.39,340.97,340.64,340.29,339.96,339.63,339.26,338.93,338.58,338.2,337.87,337.48,337.15,336.82,336.42,336.12,335.79,335.35,335.08,334.75,334.38,333.98,333.72,333.33,333.02,332.58,332.25,331.85,331.57,331.19,330.86,330.56,330.18,329.79,329.46,329.17,328.8,328.43,328.07,327.72,327.46,327.02,326.73,326.4,325.99,325.7,325.33,324.95,324.67,324.23,323.92,323.59,323.26,322.84,322.51,322.12,321.86,321.42,321.11,320.73,320.34,320.08,319.72,319.31,319.02,318.63,318.3,317.97,317.61,317.24,316.93,316.52,316.23,315.9,315.55,315.18,314.8,314.52,314.12,313.81,313.46,313.11,312.78,312.36,312.06,311.66,311.37,311,310.61,310.3,309.92,309.62,309.22,308.91,308.52,308.19,307.84,307.46,307.16,306.83,306.47,306.08,305.71,305.42,305.09,304.69,304.34,304.04,303.71,303.31,303,302.63,302.34,301.95,301.57,301.22,300.92,300.48,300.21,299.75,299.53,299.14,298.83,298.43,298.13,297.75,297.42,297.05,296.7,296.41,296.02,295.69,295.36,295,294.63,294.3,293.97,293.55,293.2,292.96,292.59,292.19,291.86,291.58,291.18,290.81,290.39,290.15,289.75,289.36,289.07,288.79,288.35,287.97,287.64,287.31,287.03,286.55,286.26,285.89,285.62,285.18,284.85,284.48,284.11,283.73,283.47,283.12,282.77,282.35,282.15,281.67,281.32,281.05,280.68,280.33,280.02,279.71,279.34,278.94,278.61,278.26,278,277.56,277.25,276.83,276.53,276.17,275.84,275.47,275.12,274.79,274.5,274.09,273.78,273.38,273.01,272.68,272.33,272.02,271.6,271.23,270.97,270.57,270.2,269.82,269.54,269.14,268.84,268.48,268.11,267.78,267.43,267.17,266.75,266.4,266.09,265.67,265.39,265.01,264.64,264.38,263.98,263.63,263.3,262.97,262.62,262.22,261.91,261.5,261.17,260.84,260.46,260.11,259.78,259.43,259.1,258.77,258.44,258.09,257.74,257.39,257.08,256.66,256.35,256,255.65,255.28,254.97,254.58,254.22,253.92,253.56,253.17,252.84,252.49,252.2,251.76,251.43,251.1,250.77,250.4,250.09,249.7,249.37,248.99,248.64,248.33,247.98,247.63,247.35,246.91,246.51,246.23,245.87,245.54,245.15,244.86,244.47,244.16,243.83,243.52,243.13,242.78,242.51,242.09,241.81,241.3,241.02,240.73,240.31,240.01,239.68,239.26,238.95,238.58,238.25,237.9,237.57,237.22,236.8,236.47,236.21,235.81,235.5,235.15,234.82,234.45,234.12,233.7,233.37,233.06,232.73,232.32,232.01,231.61,231.28,230.91,230.6,230.27,229.94,229.59,229.28,228.91,228.58,228.23,227.92,227.59,227.24,226.89,226.58,226.14,225.86,225.46,225.11,224.78,224.52,224.1,223.75,223.42,223.04,222.76,222.36,222.06,221.73,221.35,220.96,220.65,220.43,219.99,219.62,219.31,218.98,218.65,218.25,217.9,217.62,217.18,216.83,216.52,216.19,215.84,215.53,215.05,214.8,214.41,214.1,213.75,213.44,213.11,212.74,212.41,212.1,211.73,211.4,211.07,210.72,210.32,209.99,209.69,209.29,208.98,208.67,208.3,207.95,207.55,207.29,206.96,206.59,206.21,205.88,205.51,205.22,204.87,204.46,204.17,203.84,203.47,203.2,202.79,202.39,202.13,201.73,201.42,201.05,200.65,200.41,200.04,199.64,199.27,198.98,198.61,198.28,197.95,197.6,197.29,196.9,196.59,196.26,195.93,195.53,195.16,194.9,194.55,194.22,193.8,193.51,193.12,192.79,192.39,192.11,191.78,191.4,191.03,190.74,190.42,190.02,189.69,189.34,188.94,188.61,188.26,187.95,187.45,187.27,186.86,186.5,186.13,185.8,185.45,185.14,184.79,184.48,184.06,183.74,183.38,183.03,182.59,182.26,181.93,181.58,181.21,180.83,180.48,180.15,179.78,179.47,179.08,178.75,178.4,178.07,177.82,177.39,177.06,176.7,176.35,176.04,175.67,175.36,174.92,174.57,174.24,173.96,173.58,173.17,172.81,172.53,172.13,171.8,171.54,171.1,170.84,170.49,170.09,169.78,169.41,169.06,168.68,168.38,167.98,167.65,167.32,166.95,166.62,166.22,165.89,165.56,165.19,164.84,164.47,164.16,163.76,163.5,163.1,162.77,162.4,162.07,161.67,161.37,161.08,160.69,160.29,159.94,159.63,159.28,158.88,158.58,158.25,157.87,157.52,157.17,156.8,156.49,156.18,155.79,155.43,155.17,154.75,154.4,154.09,153.68,153.3,152.97,152.62,152.34,151.96,151.63,151.22,150.86,150.51,150.21,149.79,149.48,149.11,148.8,148.4,148.05,147.72,147.35,146.93,146.65,146.34,145.99,145.61,145.26,144.91,144.6,144.21,143.83,143.55,143.13,142.82,142.49,142.1,141.75,141.35,141.04,140.73,140.36,140.03,139.7,139.33,139,138.63,138.34,137.97,137.7,137.26,136.98,136.54,136.3,135.92,135.62,135.24,134.87,134.47,134.14,133.77,133.44,133.11,132.76,132.39,132.06,131.66,131.42,130.98,130.65,130.32,129.95,129.62,129.22,128.87,128.58,128.17,127.88,127.46,127.11,126.69,126.41,126.04,125.68,125.33,125.05,124.61,124.28,123.95,123.6,123.27,122.94,122.59,122.19,121.9,121.53,121.18,120.81,120.48,120.12,119.73,119.42,119.05,118.7,118.28,118.02,117.64,117.38,116.98,116.67,116.28,115.95,115.6,115.25,114.83,114.57,114.15,113.77,113.47,113.12,112.7,112.37,112.02,111.67,111.29,110.85,110.59,110.24,109.82,109.51,109.16,108.76,108.48,108.08,107.71,107.45,107.03,106.7,106.39,106.04,105.64,105.29,104.92,104.59,104.28,103.91,103.51,103.23,102.77,102.5,102.04,101.8,101.43,101.1,100.72,100.44,99.95,99.78,99.36,99.03,98.68,98.33,97.95,97.62,97.19,96.9,96.53,96.22,95.84,95.52,95.16,94.83,94.46,94.17,93.76,93.41,93.03,92.79,92.42,92,91.67,91.3,90.99,90.64,90.29,89.93,89.56,89.19,88.84,88.48,88.09,87.78,87.39,87.03,86.66,86.33,86,85.74,85.3,85.06,84.66,84.35,84,83.63,83.32,83.01,82.62,82.29,81.91,81.56,81.23,80.95,80.49,80.16,79.83,79.58,79.12,78.79,78.38,78.11,77.7,77.43,77.04,76.71,76.38,76.03,75.65,75.39,74.99,74.69,74.29,74,73.59,73.19,72.99,72.51,72.18,71.94,71.5,71.13,70.73,70.4,70.07};
    
    KalmanFilter kalmanFilter(measuresCteSpeed[0], -0.347 / timeInterval, kalmanGain.getPositionKalmanGain()/10.0);
    for(int step = 1;step < 981;step++){
        kalmanFilter.step(measuresCteSpeed[step], timeInterval);
        //printf("Position with expected mean 16.566: %f\n", kalmanFilter.getPositionEstimate());
        //printf("Velocity with expected mean 0.0: %f\n", kalmanFilter.getVelocityEstimate());
        //printf("%f\n", kalmanFilter.getPositionEstimate());
    }
    return 0;
}
